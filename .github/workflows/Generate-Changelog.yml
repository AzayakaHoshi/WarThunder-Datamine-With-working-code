name: Generate Changelog

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  generate-changelog:
    runs-on: ubuntu-latest

    steps:
      # Step to use the default checkout action to avoid manually setting up the repository
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Generate Changelog
        run: |
          echo "Generating changelog for aces.vromfs.bin_u directory..."

          # Create a new changelog file
          echo "### Full Changelog:" > CHANGELOG.md
          echo "" >> CHANGELOG.md
          echo "#### Commits Affecting aces.vromfs.bin_u Directory:" >> CHANGELOG.md

          # Get the list of commits that affected the aces.vromfs.bin_u directory
          git log --pretty=format:"- **%s** (%h) by %an on %ad" --date=short --no-merges -- aces.vromfs.bin_u > temp_log.txt

          # Check if there are relevant commits
          if [ -s temp_log.txt ]; then
              cat temp_log.txt >> CHANGELOG.md
          else
              echo "No changes in aces.vromfs.bin_u directory in recent commits." >> CHANGELOG.md
          fi

          echo "---" >> CHANGELOG.md

      - name: Commit Changelog
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add CHANGELOG.md
          git commit -m "Generated Changelog for aces.vromfs.bin_u [skip ci]"
          git push origin HEAD:$(git rev-parse --abbrev-ref HEAD) --no-verify
